<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API 參考 - ATM Banking System</title>
    <meta name="description" content="ATM Banking System API 參考文檔 - 完整的類別、方法與程式碼範例">
    <meta name="keywords" content="API, 參考文檔, C++, 類別, 方法, 程式設計">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="API 參考 - ATM Banking System">
    <meta property="og:description" content="ATM Banking System API 參考文檔">
    <meta property="og:type" content="website">
    <meta property="og:image" content="assets/images/og-image.svg">
    
    <!-- Favicon -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" href="assets/images/favicon.svg" type="image/svg+xml">
    
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css">
</head>
<body>
    <!-- 導航列 -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-university"></i>
                <span>ATM Banking System</span>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">首頁</a>
                </li>
                <li class="nav-item">
                    <a href="getting-started.html" class="nav-link">快速開始</a>
                </li>
                <li class="nav-item">
                    <a href="user-guide.html" class="nav-link">使用者指南</a>
                </li>
                <li class="nav-item">
                    <a href="api-reference.html" class="nav-link active">API 參考</a>
                </li>
                <li class="nav-item">
                    <a href="architecture.html" class="nav-link">架構設計</a>
                </li>
            </ul>
            <div class="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <!-- 主要內容 -->
    <main class="docs-main">
        <div class="docs-container">
            <!-- 側邊欄 -->
            <aside class="docs-sidebar">
                <div class="sidebar-content">
                    <h3>API 參考</h3>
                    <nav class="sidebar-nav">
                        <ul>
                            <li><a href="#overview">API 概覽</a></li>
                            <li><a href="#core-classes">核心類別</a>
                                <ul>
                                    <li><a href="#account-class">Account 類別</a></li>
                                    <li><a href="#bank-class">Bank 類別</a></li>
                                    <li><a href="#atm-class">ATM 類別</a></li>
                                    <li><a href="#transaction-class">Transaction 類別</a></li>
                                </ul>
                            </li>
                            <li><a href="#authentication">身份驗證</a>
                                <ul>
                                    <li><a href="#login-methods">登入方法</a></li>
                                    <li><a href="#pin-validation">PIN 驗證</a></li>
                                    <li><a href="#security-features">安全功能</a></li>
                                </ul>
                            </li>
                            <li><a href="#banking-operations">銀行操作</a>
                                <ul>
                                    <li><a href="#balance-inquiry">餘額查詢</a></li>
                                    <li><a href="#withdraw-api">提款 API</a></li>
                                    <li><a href="#deposit-api">存款 API</a></li>
                                    <li><a href="#transfer-api">轉帳 API</a></li>
                                </ul>
                            </li>
                            <li><a href="#admin-api">管理員 API</a>
                                <ul>
                                    <li><a href="#user-management-api">用戶管理</a></li>
                                    <li><a href="#system-monitoring-api">系統監控</a></li>
                                </ul>
                            </li>
                            <li><a href="#error-handling">錯誤處理</a></li>
                            <li><a href="#examples">程式碼範例</a></li>
                        </ul>
                    </nav>
                </div>
            </aside>

            <!-- 文檔內容 -->
            <div class="docs-content">
                <header class="docs-header">
                    <h1>API 參考文檔</h1>
                    <p>完整的 ATM Banking System API 開發指南</p>
                </header>

                <section id="overview" class="docs-section">
                    <h2><i class="fas fa-code"></i> API 概覽</h2>
                    <p>ATM Banking System 採用物件導向設計，提供完整的銀行業務 API 介面。系統支援用戶驗證、帳戶管理、交易處理和系統管理等功能。</p>
                    
                    <div class="api-info">
                        <div class="info-card">
                            <h3><i class="fas fa-language"></i> 開發語言</h3>
                            <p>C++ (標準 C++17)</p>
                        </div>
                        <div class="info-card">
                            <h3><i class="fas fa-database"></i> 資料儲存</h3>
                            <p>檔案系統 (JSON 格式)</p>
                        </div>
                        <div class="info-card">
                            <h3><i class="fas fa-terminal"></i> 介面類型</h3>
                            <p>命令列介面 (CLI)</p>
                        </div>
                        <div class="info-card">
                            <h3><i class="fas fa-shield-alt"></i> 安全機制</h3>
                            <p>PIN 驗證、帳戶鎖定</p>
                        </div>
                    </div>
                </section>

                <section id="core-classes" class="docs-section">
                    <h2><i class="fas fa-cube"></i> 核心類別</h2>

                    <div id="account-class" class="api-class">
                        <h3><i class="fas fa-user"></i> Account 類別</h3>
                        <p>代表銀行帳戶的核心類別，管理用戶帳戶資訊和基本操作。</p>
                        
                        <h4>類別宣告</h4>
                        <div class="code-block">
                            <pre><code class="language-cpp">class Account {
private:
    std::string accountNumber;
    std::string pinCode;
    double balance;
    bool isLocked;
    int failedAttempts;
    std::vector&lt;Transaction&gt; transactionHistory;

public:
    // 建構函式
    Account(const std::string& accNum, const std::string& pin, double initBalance);
    
    // 帳戶驗證
    bool validatePin(const std::string& pin);
    void lockAccount();
    void unlockAccount();
    
    // 餘額操作
    double getBalance() const;
    bool withdraw(double amount);
    void deposit(double amount);
    
    // 交易記錄
    void addTransaction(const Transaction& transaction);
    std::vector&lt;Transaction&gt; getTransactionHistory() const;
    
    // Getter 方法
    std::string getAccountNumber() const;
    bool getIsLocked() const;
    int getFailedAttempts() const;
};</code></pre>
                        </div>

                        <h4>主要方法</h4>
                        <table class="api-table">
                            <thead>
                                <tr>
                                    <th>方法</th>
                                    <th>參數</th>
                                    <th>回傳值</th>
                                    <th>說明</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>validatePin()</code></td>
                                    <td>const std::string& pin</td>
                                    <td>bool</td>
                                    <td>驗證 PIN 碼是否正確</td>
                                </tr>
                                <tr>
                                    <td><code>getBalance()</code></td>
                                    <td>無</td>
                                    <td>double</td>
                                    <td>取得帳戶餘額</td>
                                </tr>
                                <tr>
                                    <td><code>withdraw()</code></td>
                                    <td>double amount</td>
                                    <td>bool</td>
                                    <td>提款操作</td>
                                </tr>
                                <tr>
                                    <td><code>deposit()</code></td>
                                    <td>double amount</td>
                                    <td>void</td>
                                    <td>存款操作</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div id="bank-class" class="api-class">
                        <h3><i class="fas fa-university"></i> Bank 類別</h3>
                        <p>銀行系統的主要管理類別，負責帳戶管理和系統操作。</p>
                        
                        <h4>類別宣告</h4>
                        <div class="code-block">
                            <pre><code class="language-cpp">class Bank {
private:
    std::vector&lt;Account&gt; accounts;
    std::string dataFile;

public:
    Bank(const std::string& dataFile);
    
    // 帳戶管理
    Account* findAccount(const std::string& accountNumber);
    bool addAccount(const Account& account);
    bool removeAccount(const std::string& accountNumber);
    
    // 轉帳功能
    bool transfer(const std::string& fromAccount, 
                  const std::string& toAccount, 
                  double amount);
    
    // 資料持久化
    void loadData();
    void saveData();
    
    // 系統統計
    std::vector&lt;Account&gt; getAllAccounts() const;
    double getTotalBalance() const;
    int getTotalTransactions() const;
};</code></pre>
                        </div>
                    </div>

                    <div id="atm-class" class="api-class">
                        <h3><i class="fas fa-credit-card"></i> ATM 類別</h3>
                        <p>ATM 機器的主要介面類別，處理用戶互動和操作流程。</p>
                        
                        <h4>類別宣告</h4>
                        <div class="code-block">
                            <pre><code class="language-cpp">class ATM {
private:
    Bank* bank;
    Account* currentAccount;
    bool isUserLoggedIn;
    bool isAdminLoggedIn;

public:
    ATM(Bank* bankSystem);
    
    // 系統啟動
    void start();
    void showMainMenu();
    
    // 用戶操作
    bool userLogin();
    void userMenu();
    void checkBalance();
    void withdrawMoney();
    void depositMoney();
    void transferMoney();
    void viewTransactionHistory();
    void changePinCode();
    
    // 管理員操作
    bool adminLogin();
    void adminMenu();
    void viewAllUsers();
    void addNewUser();
    void deleteUser();
    void unlockUserAccount();
    
    // 系統控制
    void logout();
    void shutdown();
};</code></pre>
                        </div>
                    </div>

                    <div id="transaction-class" class="api-class">
                        <h3><i class="fas fa-exchange-alt"></i> Transaction 類別</h3>
                        <p>代表交易記錄的類別，儲存交易詳細資訊。</p>
                        
                        <h4>類別宣告</h4>
                        <div class="code-block">
                            <pre><code class="language-cpp">class Transaction {
private:
    std::string transactionId;
    std::string accountNumber;
    std::string type;  // "WITHDRAW", "DEPOSIT", "TRANSFER"
    double amount;
    double balanceAfter;
    std::string timestamp;
    std::string description;

public:
    Transaction(const std::string& account, 
                const std::string& transType,
                double amt, 
                double balance,
                const std::string& desc = "");
    
    // Getter 方法
    std::string getTransactionId() const;
    std::string getAccountNumber() const;
    std::string getType() const;
    double getAmount() const;
    double getBalanceAfter() const;
    std::string getTimestamp() const;
    std::string getDescription() const;
    
    // 格式化輸出
    std::string toString() const;
};</code></pre>
                        </div>
                    </div>
                </section>

                <section id="authentication" class="docs-section">
                    <h2><i class="fas fa-key"></i> 身份驗證</h2>

                    <div id="login-methods" class="api-method">
                        <h3>登入方法</h3>
                        <p>系統提供兩種登入方式：用戶登入和管理員登入。</p>
                        
                        <h4>用戶登入</h4>
                        <div class="code-block">
                            <pre><code class="language-cpp">bool ATM::userLogin() {
    std::string accountNumber, pinCode;
    
    std::cout << "請輸入帳號: ";
    std::cin >> accountNumber;
    
    std::cout << "請輸入 PIN 碼: ";
    std::cin >> pinCode;
    
    Account* account = bank->findAccount(accountNumber);
    if (account && !account->getIsLocked()) {
        if (account->validatePin(pinCode)) {
            currentAccount = account;
            isUserLoggedIn = true;
            return true;
        }
    }
    return false;
}</code></pre>
                        </div>

                        <h4>管理員登入</h4>
                        <div class="code-block">
                            <pre><code class="language-cpp">bool ATM::adminLogin() {
    std::string username, password;
    
    std::cout << "管理員帳號: ";
    std::cin >> username;
    
    std::cout << "管理員密碼: ";
    std::cin >> password;
    
    if (username == "admin" && password == "admin123") {
        isAdminLoggedIn = true;
        return true;
    }
    return false;
}</code></pre>
                        </div>
                    </div>

                    <div id="pin-validation" class="api-method">
                        <h3>PIN 驗證機制</h3>
                        <div class="code-block">
                            <pre><code class="language-cpp">bool Account::validatePin(const std::string& pin) {
    if (isLocked) {
        return false;
    }
    
    if (pinCode == pin) {
        failedAttempts = 0;
        return true;
    } else {
        failedAttempts++;
        if (failedAttempts >= 3) {
            lockAccount();
        }
        return false;
    }
}</code></pre>
                        </div>
                    </div>
                </section>

                <section id="banking-operations" class="docs-section">
                    <h2><i class="fas fa-coins"></i> 銀行操作</h2>

                    <div id="balance-inquiry" class="api-method">
                        <h3>餘額查詢</h3>
                        <div class="code-block">
                            <pre><code class="language-cpp">void ATM::checkBalance() {
    if (!isUserLoggedIn || !currentAccount) {
        std::cout << "請先登入!" << std::endl;
        return;
    }
    
    double balance = currentAccount->getBalance();
    std::cout << "當前餘額: $" << std::fixed << std::setprecision(2) 
              << balance << std::endl;
}</code></pre>
                        </div>
                    </div>

                    <div id="withdraw-api" class="api-method">
                        <h3>提款 API</h3>
                        <div class="code-block">
                            <pre><code class="language-cpp">void ATM::withdrawMoney() {
    if (!isUserLoggedIn || !currentAccount) {
        std::cout << "請先登入!" << std::endl;
        return;
    }
    
    double amount;
    std::cout << "請輸入提款金額: $";
    std::cin >> amount;
    
    // 驗證金額
    if (amount <= 0) {
        std::cout << "無效的金額!" << std::endl;
        return;
    }
    
    if (amount > 1000) {
        std::cout << "單次提款限額為 $1,000!" << std::endl;
        return;
    }
    
    if (currentAccount->withdraw(amount)) {
        // 記錄交易
        Transaction transaction(currentAccount->getAccountNumber(),
                              "WITHDRAW", 
                              amount,
                              currentAccount->getBalance(),
                              "ATM 提款");
        currentAccount->addTransaction(transaction);
        
        std::cout << "提款成功! 剩餘餘額: $" 
                  << currentAccount->getBalance() << std::endl;
    } else {
        std::cout << "提款失敗! 餘額不足!" << std::endl;
    }
}</code></pre>
                        </div>
                    </div>

                    <div id="deposit-api" class="api-method">
                        <h3>存款 API</h3>
                        <div class="code-block">
                            <pre><code class="language-cpp">void ATM::depositMoney() {
    if (!isUserLoggedIn || !currentAccount) {
        std::cout << "請先登入!" << std::endl;
        return;
    }
    
    double amount;
    std::cout << "請輸入存款金額: $";
    std::cin >> amount;
    
    if (amount <= 0) {
        std::cout << "無效的金額!" << std::endl;
        return;
    }
    
    currentAccount->deposit(amount);
    
    // 記錄交易
    Transaction transaction(currentAccount->getAccountNumber(),
                          "DEPOSIT", 
                          amount,
                          currentAccount->getBalance(),
                          "ATM 存款");
    currentAccount->addTransaction(transaction);
    
    std::cout << "存款成功! 當前餘額: $" 
              << currentAccount->getBalance() << std::endl;
}</code></pre>
                        </div>
                    </div>

                    <div id="transfer-api" class="api-method">
                        <h3>轉帳 API</h3>
                        <div class="code-block">
                            <pre><code class="language-cpp">bool Bank::transfer(const std::string& fromAccount, 
                   const std::string& toAccount, 
                   double amount) {
    Account* from = findAccount(fromAccount);
    Account* to = findAccount(toAccount);
    
    if (!from || !to) {
        return false;  // 帳戶不存在
    }
    
    if (from->getBalance() < amount) {
        return false;  // 餘額不足
    }
    
    // 執行轉帳
    from->withdraw(amount);
    to->deposit(amount);
    
    // 記錄交易
    Transaction fromTransaction(fromAccount, "TRANSFER_OUT", 
                               amount, from->getBalance(),
                               "轉帳至 " + toAccount);
    Transaction toTransaction(toAccount, "TRANSFER_IN", 
                             amount, to->getBalance(),
                             "收到來自 " + fromAccount + " 的轉帳");
    
    from->addTransaction(fromTransaction);
    to->addTransaction(toTransaction);
    
    return true;
}</code></pre>
                        </div>
                    </div>
                </section>

                <section id="admin-api" class="docs-section">
                    <h2><i class="fas fa-user-shield"></i> 管理員 API</h2>

                    <div id="user-management-api" class="api-method">
                        <h3>用戶管理 API</h3>
                        
                        <h4>新增用戶</h4>
                        <div class="code-block">
                            <pre><code class="language-cpp">void ATM::addNewUser() {
    std::string accountNumber, pinCode;
    double initialBalance;
    
    std::cout << "輸入新帳號: ";
    std::cin >> accountNumber;
    
    // 檢查帳號是否已存在
    if (bank->findAccount(accountNumber)) {
        std::cout << "帳號已存在!" << std::endl;
        return;
    }
    
    std::cout << "輸入 PIN 碼: ";
    std::cin >> pinCode;
    
    std::cout << "輸入初始餘額: $";
    std::cin >> initialBalance;
    
    Account newAccount(accountNumber, pinCode, initialBalance);
    if (bank->addAccount(newAccount)) {
        std::cout << "用戶新增成功!" << std::endl;
    } else {
        std::cout << "用戶新增失敗!" << std::endl;
    }
}</code></pre>
                        </div>

                        <h4>解鎖用戶帳戶</h4>
                        <div class="code-block">
                            <pre><code class="language-cpp">void ATM::unlockUserAccount() {
    std::string accountNumber;
    std::cout << "輸入要解鎖的帳號: ";
    std::cin >> accountNumber;
    
    Account* account = bank->findAccount(accountNumber);
    if (account) {
        account->unlockAccount();
        std::cout << "帳戶解鎖成功!" << std::endl;
    } else {
        std::cout << "帳戶不存在!" << std::endl;
    }
}</code></pre>
                        </div>
                    </div>
                </section>

                <section id="error-handling" class="docs-section">
                    <h2><i class="fas fa-exclamation-triangle"></i> 錯誤處理</h2>
                    
                    <h3>錯誤類型</h3>
                    <table class="api-table">
                        <thead>
                            <tr>
                                <th>錯誤類型</th>
                                <th>錯誤碼</th>
                                <th>說明</th>
                                <th>處理方式</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>帳戶不存在</td>
                                <td>ACCOUNT_NOT_FOUND</td>
                                <td>輸入的帳號不存在</td>
                                <td>提示用戶檢查帳號</td>
                            </tr>
                            <tr>
                                <td>PIN 碼錯誤</td>
                                <td>INVALID_PIN</td>
                                <td>PIN 碼驗證失敗</td>
                                <td>增加失敗次數，超過 3 次鎖定</td>
                            </tr>
                            <tr>
                                <td>帳戶鎖定</td>
                                <td>ACCOUNT_LOCKED</td>
                                <td>帳戶被鎖定</td>
                                <td>需要管理員解鎖</td>
                            </tr>
                            <tr>
                                <td>餘額不足</td>
                                <td>INSUFFICIENT_FUNDS</td>
                                <td>帳戶餘額不足</td>
                                <td>提示用戶檢查餘額</td>
                            </tr>
                            <tr>
                                <td>無效金額</td>
                                <td>INVALID_AMOUNT</td>
                                <td>輸入的金額無效</td>
                                <td>提示用戶重新輸入</td>
                            </tr>
                            <tr>
                                <td>超過限額</td>
                                <td>LIMIT_EXCEEDED</td>
                                <td>超過交易限額</td>
                                <td>提示用戶限額資訊</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>錯誤處理範例</h3>
                    <div class="code-block">
                        <pre><code class="language-cpp">try {
    if (!currentAccount->withdraw(amount)) {
        throw std::runtime_error("INSUFFICIENT_FUNDS");
    }
} catch (const std::exception& e) {
    std::cout << "錯誤: " << e.what() << std::endl;
    // 記錄錯誤日誌
    logError("提款失敗", e.what());
}</code></pre>
                    </div>
                </section>

                <section id="examples" class="docs-section">
                    <h2><i class="fas fa-code"></i> 程式碼範例</h2>
                    
                    <h3>完整的提款流程</h3>
                    <div class="code-block">
                        <pre><code class="language-cpp">#include "ATM.h"
#include "Bank.h"

int main() {
    // 初始化銀行系統
    Bank bank("accounts.json");
    bank.loadData();
    
    // 創建 ATM 實例
    ATM atm(&bank);
    
    // 啟動系統
    atm.start();
    
    return 0;
}

// 使用範例：用戶提款
void exampleWithdraw() {
    Bank bank("test_accounts.json");
    ATM atm(&bank);
    
    // 模擬用戶登入
    Account testAccount("1234567890", "1234", 1000.0);
    bank.addAccount(testAccount);
    
    // 執行提款
    Account* account = bank.findAccount("1234567890");
    if (account && account->validatePin("1234")) {
        if (account->withdraw(500.0)) {
            std::cout << "提款成功，餘額: $" << account->getBalance() << std::endl;
        }
    }
}</code></pre>
                    </div>

                    <h3>轉帳操作範例</h3>
                    <div class="code-block">
                        <pre><code class="language-cpp">void exampleTransfer() {
    Bank bank("accounts.json");
    
    // 創建兩個測試帳戶
    Account account1("1111111111", "1111", 2000.0);
    Account account2("2222222222", "2222", 500.0);
    
    bank.addAccount(account1);
    bank.addAccount(account2);
    
    // 執行轉帳：從帳戶1轉300元到帳戶2
    if (bank.transfer("1111111111", "2222222222", 300.0)) {
        std::cout << "轉帳成功!" << std::endl;
        
        Account* acc1 = bank.findAccount("1111111111");
        Account* acc2 = bank.findAccount("2222222222");
        
        std::cout << "帳戶1餘額: $" << acc1->getBalance() << std::endl;
        std::cout << "帳戶2餘額: $" << acc2->getBalance() << std::endl;
    }
}</code></pre>
                    </div>

                    <h3>交易記錄查詢</h3>
                    <div class="code-block">
                        <pre><code class="language-cpp">void exampleTransactionHistory() {
    Account account("1234567890", "1234", 1000.0);
    
    // 執行一些交易
    account.deposit(500.0);
    account.withdraw(200.0);
    
    // 查看交易記錄
    auto history = account.getTransactionHistory();
    
    std::cout << "=== 交易記錄 ===" << std::endl;
    for (const auto& transaction : history) {
        std::cout << transaction.toString() << std::endl;
    }
}</code></pre>
                    </div>
                </section>

                <!-- 回到頂部按鈕 -->
                <button id="scrollToTop" class="scroll-to-top" title="回到頂部">
                    <i class="fas fa-arrow-up"></i>
                </button>
            </div>
        </div>
    </main>

    <!-- 頁尾 -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>ATM Banking System</h3>
                <p>專業的銀行自動櫃員機模擬系統</p>
            </div>
            <div class="footer-section">
                <h4>開發資源</h4>
                <ul>
                    <li><a href="api-reference.html">API 參考</a></li>
                    <li><a href="architecture.html">架構設計</a></li>
                    <li><a href="#examples">程式碼範例</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>技術支援</h4>
                <p>Email: dev@atm-system.com</p>
                <p>GitHub: <a href="https://github.com/your-repo">Issues</a></p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 ATM Banking System. All rights reserved.</p>
        </div>
    </footer>

    <script src="assets/js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</body>
</html>
